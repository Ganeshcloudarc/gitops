<launch>
    <arg name="mission_file" default="default.json"/>
    <arg name="mission_continue" default="false"/>
    <arg name="zed_od_enable" default="false"/>

    <arg name = 'rc_control' default="false"/>
    <arg name ='rviz' default = 'true'/>
    <arg name="record" default="false"/>
    <arg name="failsafe_enable" default="false"/>

    <arg name="carla" default="false"/>
    <rosparam command="load" file="$(find autopilot)/params/patrol_params.yaml"/>

    <group if="$(eval arg('carla'))">
        <param name='/patrol/gps_topic' value = '/carla/ego_vehicle/gnss'/>
        <param name='/patrol/imu_topic' value = '/carla/ego_vehicle/imu'/>
        <param name='/patrol/odom_topic' value = '/carla/ego_vehicle/odometry'/>
        <param name="/patrol/base_frame" value ="ego_vehicle"/>
        <param name ='/patrol/max_forward_speed' value="0.3"/>
        <param name ='/patrol/min_forward_speed' value="0.01"/>
        <param name ='/patrol/max_backward_speed' value="0.3"/>
        <param name ='/patrol/min_backward_speed' value="0.01"/>

        <node name="carla_control_converter_node" pkg="autopilot" type="carla_control_converter.py" />
    </group>
    <group unless="$(arg carla)">
        <param name='/patrol/gps_topic' value = '/mavros/global_position/global'/>
        <param name='/patrol/imu_topic' value = '/mavros/imu/data'/>
        <param name='/patrol/odom_topic' value = '/mavros/global_position/local'/>

    </group>
    <param name="/patrol/failsafe_enable" value="$(arg failsafe_enable)"/>

    <param name = "/carla_sim/activate" value = "$(arg carla)"/>
    <param name = "/patrol/mission_file" value = "$(arg mission_file)"/>
    <param name="patrol/mission_continue" value ="$(arg mission_continue)"/>

    <param name="/patrol/rc_control" value="$(arg rc_control)" />
    
    <node pkg = "autopilot" type = "path_publisher.py" name = "gps_path_pub_node" />
    <node pkg = "autopilot" type = "path_tracking_pure_pursuit.py" name = "pure_pursuit_node" output = 'screen' />
    <node name="control_mode_selector" pkg="autopilot" type="control_mode_selector.py"  if = "$(eval arg('rc_control'))" output = 'screen'/>


    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find autopilot)/rviz/path.rviz" if = "$(eval arg('rviz'))"/>
    <node pkg = "autopilot" type = "markers_visualization.py" name = "visualization_marker_pure_pursuit_node" />
    <node pkg = "autopilot" type = "odom_path_plotter.py" name = "odom_path_plotter_node">
        <param name="max_list_append" value="300" />
    </node>
    

    <node name="bag_record" pkg="rosbag" type="record"
        args="record -o $(env HOME)/.bags/boson -a -x /zed2i/(.*) " if="$(eval record)"/>
    
    <include file="$(find vehicle_common)/launch/vehicle_description.launch"> </include>

    <group if="$(eval arg('failsafe_enable'))">
        <include file="$(find autopilot)/launch/failsafe_manager.launch">
            <arg name="use_zed_camera"         value="true" />
            <arg name="use_oak_camera"            value="false" />
            <arg name="vehicle_safety_diagnostics" value="true"/>
            <arg name="use_emergeny_stop" value ="true"/>
        </include>
    </group>
</launch>







